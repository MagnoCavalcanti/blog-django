{% extends 'base.html' %}
{% load static %}

{% block title %}{{ post.title }} - Meu Blog{% endblock %}
{% block extra_css %} 
<link rel="stylesheet" href="{% static '/style/post.css' %}">
{% endblock %}
{% block conteudo %}
<div class="container" style="padding-top:18px;">
	<dialog id="edit-modal">
         <form method="POST" action="{% url 'post_edit' post.pk %}" class="edit-post-form">
            {% csrf_token %}
            <input type="text" name="title" placeholder="Titulo do post" required class="edit-post-title" value="{{ post.title }}">
            <textarea name="content" placeholder="O que voce esta pensando?" required class="edit-post-content">{{ post.content }}</textarea>
            <button type="submit" class="edit-post-submit">Publicar</button>
         </form>
     </dialog>
	<dialog>
         <form method="POST" action="{% url 'post_edit' post.pk %}" class="edit-post-form">
            {% csrf_token %}
            <input type="text" name="title" placeholder="Titulo do post" required class="edit-post-title" value="{{ post.title }}">
            <textarea name="content" placeholder="O que voce esta pensando?" required class="edit-post-content">{{ post.content }}</textarea>
            <button type="submit" class="edit-post-submit">Publicar</button>
         </form>
     </dialog>
	<article class="post">
		<div class="post-header">
			<div class="post-user-info">
				<span class="post-user-name">{{ post.author.first_name }} {{ post.author.last_name }}</span>
				<span class="post-user-handle">@{{ post.author.username|lower }}</span>
				<span class="post-time">· {{ post.created_by|timesince }}</span>
				{% if user == post.author %}
					<div class="dropdown">
						<button class="dropbtn">
							<img width="15" height="15" src="https://img.icons8.com/ios-glyphs/30/8899a6/ellipsis.png" alt="ellipsis"/>
						</button>
						<div class="dropdown-content">
							<span id="edit">Editar</span>
							<span id="delete">Excluir</span>
						</div>
					</div>
				{% endif %}
				<div class="post-title">
					<h2>{{ post.title }}</h2>
				</div>

				<div class="post-content" style="margin-top:10px; color:#dde7eb;">
					<p>{{ post.content }}</p>
				</div>

				<div style="margin-top:10px; display:flex; gap:16px; align-items:center; color:#8899a6; font-size:15px;">
    
    <span style="display:flex; gap:4px; align-items:center;">
		
        <svg viewBox="0 0 24 24" width="18" height="18">
                <path fill="currentColor" d="M1.998 12.5c2.003-4.5 6.003-7.5 10.002-7.5s8 3 10.002 7.5c-2.002 4.5-6.002 7.5-10.002 7.5s-8-3-10.002-7.5zm10.002 5.5c3.038 0 5.5-2.462 5.5-5.5s-2.462-5.5-5.5-5.5-5.5 2.462-5.5 5.5 2.462 5.5 5.5 5.5zm0-9a3.5 3.5 0 1 1 0 7 3.5 3.5 0 0 1 0-7z"></path>
            </svg> 
        <span>{{ post.views_count }}</span>
    </span>

    <span style="display:flex; gap:4px; align-items:center;" id="like-btn">
		{% if liked %}
		<img width="18" height="18" src="https://img.icons8.com/fluency-systems-filled/48/F91880/like.png" alt="like"/>
		<span class="active" id="like-count">{{ post.likes.count }}</span>
		{% else %}
        <img width="18" height="18" src="https://img.icons8.com/fluency-systems-regular/48/8899a6/like--v1.png" alt="like--v1"/>
        <span id="like-count">{{ post.likes.count }}</span>
		{% endif %}

    </span>

</div>
					
				</div>
			</div>
		</div>
	</article>

	<section class="comments" style="margin-top:18px;">
		<h3>Comentários ({{ comments.count }})</h3>

		{% if comments %}
			<ul style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px;">
				{% for comment in comments %}
					<li style="background:#0f1418; padding:10px; border-radius:8px;">
						<strong>{{ comment.author.first_name }} {{ comment.author.last_name }}</strong> <span style="color:#8899a6;">· {{ comment.created_by|timesince }}</span>
						<div style="margin-top:6px; color:#dde7eb;">{{ comment.content }}</div>
					</li>
				{% endfor %}
			</ul>
		{% else %}
			<p>Nenhum comentário ainda. Seja o primeiro!</p>
		{% endif %}

		<form method="post" action="{% url 'post_detail' post.id %}" style="margin-top:12px;" class="new-comment-form">
		<form method="post" action="{% url 'post_detail' post.id %}" style="margin-top:12px;" class="new-comment-form">
			{% csrf_token %}
			<textarea name="content" placeholder="Adicione um comentário..." required style="width:100%; min-height:80px; padding:10px; border-radius:8px; background:#071014; color:#e6eef2; border:1px solid rgba(255,255,255,0.04); resize: none;"></textarea>
			<div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px;">
				<a href="{% url 'feed' %}" class="btn-ghost" style="text-decoration:none; display:inline-flex; align-items:center;">Voltar</a>
				<button type="submit" class="btn-primary">Comentar</button>
			</div>
		</form>
	</section>
</div>

{% endblock %}

{% block scripts %}
    <script src="{% static 'js/post.js' %}"></script>
	<script>
    const CSRF_TOKEN = "{{ csrf_token }}"; // O Django substitui aqui!
	</script>
{% endblock %}